<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Safaricom STK Push Demo</title>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <style>
        .loader {
          border: 16px solid #f3f3f3;
          border-radius: 50%;
          border-top: 16px solid #3498db;
          width: 120px;
          height: 120px;
          -webkit-animation: spin 2s linear infinite; /* Safari */
          animation: spin 2s linear infinite;
        }

        /* Safari */
        @-webkit-keyframes spin {
          0% { -webkit-transform: rotate(0deg); }
          100% { -webkit-transform: rotate(360deg); }
        }

        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }

        .container {
            margin-right: auto;
            margin-left: auto;
        }
    </style>
</head>
<body>
     <div class="container">
         <h1>Safaricom STK Push Demo</h1>
         <div class="row">
             <h4>Payment Details</h4>
             <div class="col-md-6">
                <form action="" id ="form" method="post">
                    <div class="form-group">
                        <label for="inputPhoneNumber">Phone Number</label>
                        <input type="text" minlength="9" maxlength="13" pattern="^(?:254|\+254|0)?(7(?:(?:[129][0-9])|(?:0[0-8])|(4[0-1]))[0-9]{6})$"
                               title="Input a Valid Safaricom Number. Sample formats (+254729******, 254729******, 0729******)" required=""
                               class="form-control" name="phone" id="phone" value="" placeholder="+254XXXXXXXXX">
                    </div>
                    <div class="form-group">
                        <label for="inputAmount">Amount</label>
                        <input type="number" class="form-control" name="amount" id="amount"
                               placeholder="(KHS 0-70000)" min="0" max="700000" step="1" required/>
                    </div>
                    <input type="submit" class="btn btn-primary">
                </form>

                 <br>
                 <div id="processing">
                     <h3>Processing your request</h3>
                     <div class="loader" id="loader"></div>
                 </div>
             </div>
             <div class="col-md-4">
                 <img src="https://remtech.org/wp-content/uploads/2017/05/RT-safaricom-m-pesa.jpg" alt="mpesa">
             </div>
         </div>
     </div>
    <p id="msg"></p>
    <script type="text/javascript" charset="utf-8">
        $('#processing')[0].style.display = "none";
        $('#msg')[0].style.display = "none" ;
        var socket = io.connect('https://mpesatestapp.herokuapp.com/');
        socket.on('connect', function() {
            socket.emit('connection', {data: 'I\'m connected!'});
        });

        socket.on('completed', function(message) {
             $('#processing')[0].style.display = "none";
             $('#msg')[0].style.display = "block" ;
             $('#msg')[0].innerHTML = message ;
        });

         socket.on('processing', function(message) {
             $('#processing')[0].style.display = "block"; ;
        });

        $("#form").submit(function(e) {
            $('#msg')[0].style.display = "none" ;
            e.preventDefault();
            values = $(this);
            console.log(values);
            json= JSON.stringify({"phone_number" : values[0][0].value, "amount": values[0][1].value });
            console.log(json);

            socket.emit('submission', json);
        });
    </script>
</body>
</html>
